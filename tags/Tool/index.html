
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Tag: Tool | 左手代码 右手年华</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="一个尘世迷途小码农的程序与人生">
<meta property="og:type" content="website">
<meta property="og:title" content="左手代码 右手年华">
<meta property="og:url" content="http://www.harrycode.com/tags/Tool/index.html">
<meta property="og:site_name" content="左手代码 右手年华">
<meta property="og:description" content="一个尘世迷途小码农的程序与人生">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="左手代码 右手年华">
<meta name="twitter:description" content="一个尘世迷途小码农的程序与人生">
  
    <link rel="alternative" href="/atom.xml" title="左手代码 右手年华" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
</head>
<body>
<div id="container">
  <div id="wrap">
    <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">左手代码 右手年华</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">一个尘世迷途小码农的程序与人生</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="http://www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
          <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="Search">
          <input type="submit" value="" class="search-form-submit">
          <input name=tn type=hidden value="bds">
          <input name=cl type=hidden value="3">
          <input name=ct type=hidden value="2097152">
          <input type="hidden" name="si" value="www.harrycode.com">
        </form>
      </div>
    </div>
  </div>
</header>
    <div class="outer">
      <section id="main">
  
    <article id="post-nginx-monitoring-tool-ngxtop" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/05/20/nginx-monitoring-tool-ngxtop/" class="article-date">
  <time datetime="2014-05-20T04:01:00.000Z" itemprop="datePublished">2014-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/20/nginx-monitoring-tool-ngxtop/">Nginx监控利器 Ngxtop</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="简介">简介</h1><p>Nginx 作为新一代的WebServer + ProxyServer， 以其优秀的并发能力，已被广泛接受。使用之广，直逼界内前辈 Apache。今天我们介绍一款Nginx的监控工具 <a href="https://github.com/lebinh/ngxtop#rd" target="_blank" rel="external">Ngxtop</a>，这款工具基于AccessLog的解析，为我们提供非常友好的统计方式，统计各个页面的request_path, remote_addr, status等，并基于字段order/group，监控起来自然是比awk这些工具要方便许多。<strong>附官方Demo：</strong></p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ ngxtop</span><br><span class="line">running for <span class="number">411</span> seconds, <span class="number">64332</span> records processed: <span class="number">156.60</span> req/sec</span><br><span class="line"></span><br><span class="line">Summary:</span><br><span class="line"><span class="string">|   count |   avg_bytes_sent |   2xx |   3xx |   4xx |   5xx |</span></span><br><span class="line"><span class="string">|---------+------------------+-------+-------+-------+-------|</span></span><br><span class="line"><span class="string">|   64332 |         2775.251 | 61262 |  2994 |    71 |     5 |</span></span><br><span class="line"></span><br><span class="line">Detailed:</span><br><span class="line"><span class="string">| request_path                             |   count |   avg_bytes_sent |   2xx |   3xx |   4xx |   5xx |</span></span><br><span class="line"><span class="string">|------------------------------------------+---------+------------------+-------+-------+-------+-------|</span></span><br><span class="line"><span class="string">| /abc/xyz/xxxx                            |   20946 |          434.693 | 20935 |     0 |    11 |     0 |</span></span><br><span class="line"><span class="string">| /xxxxx.json                              |    5633 |         1483.723 |  5633 |     0 |     0 |     0 |</span></span><br><span class="line"><span class="string">| /xxxxx/xxx/xxxxxxxxxxxxx                 |    3629 |         6835.499 |  3626 |     0 |     3 |     0 |</span></span><br><span class="line"><span class="string">| /xxxxx/xxx/xxxxxxxx                      |    3627 |        15971.885 |  3623 |     0 |     4 |     0 |</span></span><br><span class="line"><span class="string">| /xxxxx/xxx/xxxxxxx                       |    3624 |         7830.236 |  3621 |     0 |     3 |     0 |</span></span><br><span class="line"><span class="string">| /static/js/minified/utils.min.js         |    3031 |         1781.155 |  2104 |   927 |     0 |     0 |</span></span><br><span class="line"><span class="string">| /static/js/minified/xxxxxxx.min.v1.js    |    2889 |         2210.235 |  2068 |   821 |     0 |     0 |</span></span><br><span class="line"><span class="string">| /static/tracking/js/xxxxxxxx.js          |    2594 |         1325.681 |  1927 |   667 |     0 |     0 |</span></span><br><span class="line"><span class="string">| /xxxxx/xxx.html                          |    2521 |          573.597 |  2520 |     0 |     1 |     0 |</span></span><br><span class="line"><span class="string">| /xxxxx/xxxx.json                         |    1840 |          800.542 |  1839 |     0 |     1 |     0 |</span></span><br></pre></td></tr></table></figure>
<h1 id="安装">安装</h1><p>Ngxtop 是基于Python编写的，依赖Python，通过pip即可安装。一般服务器都会遇装Python，只是版本高低各有不同。安装Python的文章可以随手找到，不再赘述。</p>
<h2 id="pip">pip</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget --<span class="keyword">no</span>-check-certificate http<span class="variable">s:</span>//bootstrap.pypa.io/<span class="built_in">get</span>-pip.<span class="keyword">py</span></span><br><span class="line"><span class="keyword">python</span> <span class="built_in">get</span>-pip.<span class="keyword">py</span></span><br></pre></td></tr></table></figure>
<h2 id="Ngxtop">Ngxtop</h2><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">beta-<span class="number">01</span>#  pip install ngxtop</span><br><span class="line"></span><br><span class="line">Downloading/unpacking ngxtop</span><br><span class="line">  Downloading ngxtop-<span class="number">0.0</span>.2-py2.py3-none-any.whl</span><br><span class="line">Downloading/unpacking pyparsing (from ngxtop)</span><br><span class="line">  Downloading pyparsing-<span class="number">2.0</span>.2.tar.gz (<span class="number">1.1</span>MB): <span class="number">1.1</span>MB downloaded</span><br><span class="line">  Running setup.py (<span class="string">path:</span><span class="regexp">/tmp/</span>pip_build_root<span class="regexp">/pyparsing/</span>setup.py) egg_info <span class="keyword">for</span> <span class="keyword">package</span> pyparsing</span><br><span class="line">Downloading/unpacking docopt (from ngxtop)</span><br><span class="line">  Downloading docopt-<span class="number">0.6</span>.1.tar.gz</span><br><span class="line">  Running setup.py (<span class="string">path:</span><span class="regexp">/tmp/</span>pip_build_root<span class="regexp">/docopt/</span>setup.py) egg_info <span class="keyword">for</span> <span class="keyword">package</span> docopt</span><br><span class="line">Downloading/unpacking tabulate (from ngxtop)</span><br><span class="line">  Downloading tabulate-<span class="number">0.7</span>.2.tar.gz</span><br><span class="line">  Running setup.py (<span class="string">path:</span><span class="regexp">/tmp/</span>pip_build_root<span class="regexp">/tabulate/</span>setup.py) egg_info <span class="keyword">for</span> <span class="keyword">package</span> tabulate</span><br><span class="line">Installing collected <span class="string">packages:</span> ngxtop, pyparsing, docopt, tabulate</span><br><span class="line">  Running setup.py install <span class="keyword">for</span> pyparsing</span><br><span class="line">  Running setup.py install <span class="keyword">for</span> docopt</span><br><span class="line">  Running setup.py install <span class="keyword">for</span> tabulate</span><br><span class="line">Successfully installed ngxtop pyparsing docopt tabulate</span><br><span class="line">Cleaning up...</span><br></pre></td></tr></table></figure>
<h1 id="使用">使用</h1><p>老规矩，看看help</p>
<p>Options:<br><code>-l &lt;file&gt;, --access-log &lt;file&gt;  access log file to parse.</code>  #指定access log<br><code>-f &lt;format&gt;, --log-format &lt;format&gt;  log format as specify in log_format directive. [default: combined]</code> #指定 log format<br><code>--no-follow  ngxtop default behavior is to ignore current lines in log and only watch for new lines as they are written to the access log. Use this flag to tell ngxtop to process the current content of the access log instead.</code> #ngxtop默认会对accesslog的新增行进行统计， 通过这个选项可以让ngxtop统计旧log<br><code>-t &lt;seconds&gt;, --interval &lt;seconds&gt;  report interval when running in follow mode [default: 2.0]</code><br><code>-g &lt;var&gt;, --group-by &lt;var&gt;  group by variable [default: request_path]</code> # 基于字段分组<br><code>-w &lt;var&gt;, --having &lt;expr&gt;  having clause [default: 1]</code> # 分组之后再筛选<br><code>-o &lt;var&gt;, --order-by &lt;var&gt;  order of output for default query [default: count]</code> # 排序字段<br><code>-n &lt;number&gt;, --limit &lt;number&gt;  limit the number of records included in report for top command [default: 10]</code> #默认显示前多少条<br><code>-a &lt;exp&gt; ..., --a &lt;exp&gt; ...  add exp (must be aggregation exp: sum, avg, min, max, etc.) into output</code> # 对输出字段做附加条件 sum/avg/min/max 可选</p>
<p><code>-v, --verbose  more verbose output</code><br><code>-d, --debug  print every line and parsed record</code><br><code>-h, --help  print this help message.</code><br><code>--version  print version information.</code></p>
<p>Advanced / experimental options:<br><code>-c &lt;file&gt;, --config &lt;file&gt;  allow ngxtop to parse nginx config file for log format and location.</code> # 指定nginx config文件，ngxtop 会自动解析配置文件，分析出access log的位置以及格式<br><code>-i &lt;filter-expression&gt;, --filter &lt;filter-expression&gt;  filter in, records satisfied given expression are processed.</code><br><code>-p &lt;filter-expression&gt;, --pre-filter &lt;filter-expression&gt; in-filter expression to check in pre-parsing phase.</code></p>
<p>一些demo<br><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Examples:</span><br><span class="line">    <span class="keyword">All</span> examples read nginx config <span class="keyword">file</span> <span class="keyword">for</span> <span class="keyword">access</span> log location <span class="keyword">and</span> format.</span><br><span class="line">    <span class="keyword">If</span> you want <span class="keyword">to</span> specify the <span class="keyword">access</span> log <span class="keyword">file</span> <span class="keyword">and</span> / <span class="keyword">or</span> log format, <span class="keyword">use</span> the -f <span class="keyword">and</span> -a options.</span><br><span class="line"></span><br><span class="line">    <span class="string">"top"</span> like view <span class="keyword">of</span> nginx requests</span><br><span class="line">    $ ngxtop</span><br><span class="line"></span><br><span class="line">    Top <span class="number">10</span> requested path <span class="keyword">with</span> status <span class="number">404</span>:</span><br><span class="line">    $ ngxtop top request_path <span class="comment">--filter 'status == 404'</span></span><br><span class="line"></span><br><span class="line">    Top <span class="number">10</span> requests <span class="keyword">with</span> highest total bytes sent</span><br><span class="line">    $ ngxtop <span class="comment">--order-by 'avg(bytes_sent) * count'</span></span><br><span class="line"></span><br><span class="line">    Top <span class="number">10</span> remote address, e.g., who<span class="attribute">'s</span> hitting you the most</span><br><span class="line">    $ ngxtop <span class="comment">--group-by remote_addr</span></span><br><span class="line"></span><br><span class="line">    Print requests <span class="keyword">with</span> <span class="number">4</span>xx <span class="keyword">or</span> <span class="number">5</span>xx status, together <span class="keyword">with</span> status <span class="keyword">and</span> http referer</span><br><span class="line">    $ ngxtop -i <span class="attribute">'status</span> &gt;= <span class="number">400</span>' print request status http_referer</span><br><span class="line"></span><br><span class="line">    Average <span class="keyword">body</span> bytes sent <span class="keyword">of</span> <span class="number">200</span> responses <span class="keyword">of</span> requested path <span class="keyword">begin</span> <span class="keyword">with</span> <span class="attribute">'foo</span>':</span><br><span class="line">    $ ngxtop avg bytes_sent <span class="comment">--filter 'status == 200 and request_path.startswith("foo")'</span></span><br><span class="line"></span><br><span class="line">    Analyze apache <span class="keyword">access</span> log from remote machine using <span class="attribute">'common</span>' log format</span><br><span class="line">    $ ssh remote tail -f /var/log/apache2/<span class="keyword">access</span>.log | ngxtop -f common</span><br></pre></td></tr></table></figure></p>
<p>实际使用下来还是很方便的，可以很方便看到403／500／404等情况，有利于我们掌握当前的服务质量。</p>
<p>Enjoy~</p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://www.harrycode.com/2014/05/20/nginx-monitoring-tool-ngxtop/" data-id="cibq3ipoc000egh6ai8ne91s2" class="article-share-link">分享到</a>
      

      

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tool/">Tool</a></li></ul>

    </footer>
  </div>
  
</article>


  
  
</section>
      
      <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Nginx/">Nginx</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tool/">Tool</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tools/">Tools</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/">php</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/">vim</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/Linux/" style="font-size: 20px;">Linux</a><a href="/tags/Tool/" style="font-size: 10px;">Tool</a><a href="/tags/Tools/" style="font-size: 15px;">Tools</a><a href="/tags/git/" style="font-size: 10px;">git</a><a href="/tags/php/" style="font-size: 10px;">php</a><a href="/tags/vim/" style="font-size: 10px;">vim</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">七月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">十二月 2014</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">六月 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/05/">五月 2014</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">四月 2014</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">近期文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2015/07/05/nginx-manual-note-CORE-FUNC/">Nginx手册阅读笔记 —— 核心指令</a>
          </li>
        
          <li>
            <a href="/2014/12/03/2014-12-03-to-hadoop-working-mechanism/">[转]  Hadoop工作机制</a>
          </li>
        
          <li>
            <a href="/2014/12/03/to-understand-mapreduce-data-flow/">[转] 理解MapReduce数据流</a>
          </li>
        
          <li>
            <a href="/2014/12/03/to-briefly-introduce-each-major-module-of-hadoop/">[转] 简要介绍Hadoop的各个主要模块</a>
          </li>
        
          <li>
            <a href="/2014/12/03/to-to-quickly-grasp-mapreduce/">[转] 快速理解MapReduce</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2015 Harry<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
      .
      Theme by <a href="https://github.com/xiangming/landscape-plus" target="_blank">Landscape-plus</a>
    </div>
  </div>
</footer>
  </div>
  <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
  <!-- totop start -->
<div id="totop">
<a title="返回顶部"><img src="/img/scrollup.png"/></a>
</div>

<!-- totop end -->


<!-- 百度分享 start -->

<!-- 百度分享 end -->

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>



<! -- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
                processEscapes: true
                    
}
  
        });
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
tex2jax: {
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
                  
}
    
        });
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Queue(function() {
            var all = MathJax.Hub.getAllJax(), i;
            for(i=0; i < all.length; i += 1) {
                            all[i].SourceElement().parentNode.className += ' has-jax';
                                    
            }
                
        });
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<script src="/js/script.js" type="text/javascript"></script>

</div>
</body>
</html>
